<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>PS Silks Kanchipuram ‚Äì a digital shopping</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="./assets/css/main.css" />
</head>
<body>
  <div class="app-shell">
    <header>
      <div class="logo-area">
        <div class="logo-round"></div>
        <div>
          <h1>PS Silks Kanchipuram</h1>
          <span class="tagline">a digital shopping</span>
        </div>
      </div>

      <div class="header-actions">
        <span class="pill">Kanchipuram silks ‚Ä¢ WhatsApp to buy</span>
        <button class="btn btn-primary" id="scrollToShopBtn">Browse collection</button>
      </div>
    </header>

    <main>
      <!-- LEFT: products -->
      <section class="products-panel">
        <div class="hero-card">
          <div class="hero-copy">
            <h2>Handpicked Kanchipuram & soft silk sarees</h2>
            <p>
              Explore curated pre-loved & surplus sarees from PS Silks Kanchipuram and book easily on WhatsApp.
            </p>
            <div class="hero-meta">
              <span class="stats">‚≠ê Temple-town originals</span>
              <span class="stats">üìç Based in Kanchipuram</span>
            </div>
          </div>
        </div>

        <!-- FILTERS -->
        <section class="filters-card" id="shop">
          <h3>Filter sarees</h3>

          <div class="field">
            <label for="fabricFilter">Fabric</label>
            <select id="fabricFilter">
              <option value="">All fabrics</option>
              <option value="Silk">Silk</option>
              <option value="Cotton">Cotton</option>
              <option value="Linen">Linen</option>
              <option value="Georgette">Georgette</option>
              <option value="Other">Other</option>
            </select>
          </div>

          <div class="field">
            <label for="conditionFilter">Condition</label>
            <select id="conditionFilter">
              <option value="">Any</option>
              <option value="Like New">Like New</option>
              <option value="Gently Used">Gently Used</option>
              <option value="Vintage">Vintage</option>
            </select>
          </div>

          <div class="field">
            <label for="maxPriceFilter">Max Price (‚Çπ)</label>
            <input type="number" id="maxPriceFilter" placeholder="e.g. 2500" min="0" />
          </div>

          <button class="btn" id="clearFiltersBtn">Clear</button>
        </section>

        <!-- PRODUCTS GRID -->
        <section class="products-grid" id="productsGrid"></section>

        <div class="empty-state" id="emptyState" style="display:none;">
          No sarees match these filters. Try changing fabric, condition or price.
        </div>
      </section>

      <!-- RIGHT SIDE INFO -->
      <aside class="side-panel">
        <section class="panel-card">
          <h3>How to buy</h3>
          <p>Booking a saree with PS Silks Kanchipuram is simple:</p>
          <ul class="steps-list">
            <li>Browse the Kanchipuram & soft silk collection on the left.</li>
            <li>Click the <strong>WhatsApp</strong> button on any saree.</li>
            <li>Ask for drape video, close-up pallu & border photos.</li>
            <li>Confirm price, shipping and payment directly on WhatsApp.</li>
          </ul>
        </section>
      </aside>
    </main>

    <footer>
      ¬© <span id="yearSpan"></span> PS Silks Kanchipuram ‚Ä¢ a digital shopping.
    </footer>
  </div>

  <script>
    let sarees = [];

    async function loadSareesFromCsv() {
      const response = await fetch("./assets/data/sarees.csv?v=" + Date.now());
      if (!response.ok) {
        throw new Error("Failed to load sarees.csv");
      }
      const text = await response.text();

      const lines = text.trim().split(/\r?\n/);
      if (lines.length <= 1) return [];

      const [headerLine, ...rows] = lines;
      const headers = headerLine.split(",").map((h) => h.trim());

      return rows
        .filter((r) => r.trim().length > 0)
        .map((row, rowIndex) => {
          const cols = row.split(",");
          const raw = {};
          headers.forEach((h, i) => {
            raw[h] = (cols[i] || "").trim();
          });

          return {
            id: raw.id || rowIndex + 1,
            title: raw.title || "",
            fabric: raw.fabric || "",
            condition: raw.condition || "",
            price: Number(raw.price || 0),
            city: raw.city || "Kanchipuram",
            blouse: raw.blouse || "",
            tagLine: raw.tagLine || "",
            whatsapp: raw.whatsapp || "919884191310",
            imageUrl: raw.imageUrl || ""
          };
        });
    }

    const productsGrid = document.getElementById("productsGrid");
    const emptyState = document.getElementById("emptyState");

    const fabricFilter = document.getElementById("fabricFilter");
    const conditionFilter = document.getElementById("conditionFilter");
    const maxPriceFilter = document.getElementById("maxPriceFilter");
    const clearFiltersBtn = document.getElementById("clearFiltersBtn");

    function renderSarees(list) {
      productsGrid.innerHTML = "";

      if (!list.length) {
        emptyState.style.display = "block";
        return;
      }
      emptyState.style.display = "none";

      list.forEach((s) => {
        const card = document.createElement("article");
        card.className = "card";
        card.innerHTML = `
          <div class="card-img">
            <span class="badge">${s.condition || ""}</span>
            ${s.imageUrl ? `<img src="${s.imageUrl}" alt="${s.title}" />` : ""}
          </div>
          <div class="card-body">
            <div class="card-title">${s.title}</div>
            <div class="card-meta">
              <span>${s.fabric}</span>
              <span>Blouse: ${s.blouse}</span>
              <span>${s.city}</span>
            </div>
            <div class="card-tags">
              ${s.tagLine ? `<span class="card-tag">${s.tagLine}</span>` : ""}
            </div>
            <div class="card-price-row">
              <div class="price">
                ‚Çπ${s.price.toLocaleString("en-IN")}
                <small>+ shipping</small>
              </div>
              <button class="btn btn-outline btn-sm" data-id="${s.id}">
                WhatsApp
              </button>
            </div>
          </div>
        `;
        productsGrid.appendChild(card);
      });

      // WhatsApp click handlers
      document.querySelectorAll(".card button[data-id]").forEach((btn) => {
        btn.addEventListener("click", () => {
          const id = btn.getAttribute("data-id");
          const saree = sarees.find((x) => String(x.id) === String(id));
          if (!saree) return;

          const msg =
            `Hi PS Silks Kanchipuram, I'm interested in this saree:\n\n` +
            `*${saree.title}*\n` +
            `Fabric: ${saree.fabric}\n` +
            `Condition: ${saree.condition}\n` +
            `Price: ‚Çπ${saree.price.toLocaleString("en-IN")}\n` +
            `City: ${saree.city}\n\n` +
            `Is it still available?`;

          const encoded = encodeURIComponent(msg);
          const url = `https://wa.me/${saree.whatsapp}?text=${encoded}`;
          window.open(url, "_blank");
        });
      });
    }

    function applyFilters() {
      const fabricVal = fabricFilter.value;
      const conditionVal = conditionFilter.value;
      const maxPriceVal = maxPriceFilter.value
        ? Number(maxPriceFilter.value)
        : null;

      const filtered = sarees.filter((s) => {
        if (fabricVal && s.fabric !== fabricVal) return false;
        if (conditionVal && s.condition !== conditionVal) return false;
        if (maxPriceVal !== null && s.price > maxPriceVal) return false;
        return true;
      });

      renderSarees(filtered);
    }

    fabricFilter.addEventListener("change", applyFilters);
    conditionFilter.addEventListener("change", applyFilters);
    maxPriceFilter.addEventListener("input", applyFilters);
    clearFiltersBtn.addEventListener("click", () => {
      fabricFilter.value = "";
      conditionFilter.value = "";
      maxPriceFilter.value = "";
      applyFilters();
    });

    function scrollToElement(el) {
      el.scrollIntoView({ behavior: "smooth", block: "start" });
    }

    document
      .getElementById("scrollToShopBtn")
      .addEventListener("click", () => {
        scrollToElement(document.getElementById("shop"));
      });

    // Init ‚Äì load CSV then render
    loadSareesFromCsv()
      .then((list) => {
        sarees = list;
        renderSarees(sarees);
      })
      .catch((err) => {
        console.error(err);
        emptyState.textContent = "Could not load sarees list. Please try later.";
        emptyState.style.display = "block";
      });

    document.getElementById("yearSpan").textContent =
      new Date().getFullYear();
  </script>
</body>
</html>
