<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>PS Silks Kanchipuram ‚Äì a digital shopping</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="./assets/css/main.css" />
  <style>
    /* Quick thumbnail styling for multiple images */
    .card-main-img {
      width: 100%;
      max-height: 300px;
      object-fit: cover;
      border-radius: 6px;
    }
    .card-thumbs {
      display: flex;
      gap: 6px;
      margin-top: 4px;
      flex-wrap: wrap;
    }
    .card-thumbs .thumb-img {
      width: 50px;
      height: 50px;
      object-fit: cover;
      cursor: pointer;
      border-radius: 4px;
      border: 1px solid #ccc;
      transition: 0.2s;
    }
    .card-thumbs .thumb-img:hover {
      border-color: #007bff;
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <header>
      <div class="logo-area">
        <div class="logo-round"></div>
        <div>
          <h1>PS Silks Kanchipuram</h1>
          <span class="tagline">a digital shopping</span>
        </div>
      </div>
      <div class="header-actions">
        <span class="pill">Kanchipuram silks ‚Ä¢ WhatsApp to buy</span>
        <button class="btn btn-primary" id="scrollToShopBtn">Browse collection</button>
      </div>
    </header>

    <main>
      <!-- LEFT: products -->
      <section class="products-panel">
        <div class="hero-card">
          <div class="hero-copy">
            <h2>Handpicked Kanchipuram & soft silk sarees</h2>
            <p>Explore curated pre-loved & surplus sarees from PS Silks Kanchipuram and book easily on WhatsApp.</p>
            <div class="hero-meta">
              <span class="stats">‚≠ê Temple-town originals</span>
              <span class="stats">üìç Based in Kanchipuram</span>
            </div>
          </div>
        </div>

        <!-- FILTERS -->
        <section class="filters-card" id="shop">
          <h3>Filter sarees</h3>
          <div class="field">
            <label for="fabricFilter">Fabric</label>
            <select id="fabricFilter">
              <option value="">All fabrics</option>
              <option value="Silk">Silk</option>
              <option value="Cotton">Cotton</option>
              <option value="Linen">Linen</option>
              <option value="Georgette">Georgette</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <div class="field">
            <label for="conditionFilter">Condition</label>
            <select id="conditionFilter">
              <option value="">Any</option>
              <option value="Like New">Like New</option>
              <option value="Vintage(Retro collection)">Vintage</option>
              <option value="Clearence Sale !">Vintage</option>
            </select>
          </div>
          <div class="field">
            <label for="maxPriceFilter">Max Price (‚Çπ)</label>
            <input type="number" id="maxPriceFilter" placeholder="e.g. 2500" min="0" />
          </div>
          <button class="btn" id="clearFiltersBtn">Clear</button>
        </section>

        <!-- PRODUCTS GRID -->
        <section class="products-grid" id="productsGrid"></section>

        <div class="empty-state" id="emptyState" style="display:none;">
          No sarees match these filters. Try changing fabric, condition or price.
        </div>
      </section>

      <!-- RIGHT SIDE INFO -->
      <aside class="side-panel">
        <section class="panel-card">
          <h3>How to buy</h3>
          <p>Booking a saree with PS Silks Kanchipuram is simple:</p>
          <ul class="steps-list">
            <li>Browse the Kanchipuram & soft silk collection on the left.</li>
            <li>Click the <strong>WhatsApp</strong> button on any saree.</li>
            <li>Ask for drape video, close-up pallu & border photos.</li>
            <li>Confirm price, shipping and payment directly on WhatsApp.</li>
          </ul>
        </section>
      </aside>
    </main>

    <footer>
      ¬© <span id="yearSpan"></span> PS Silks Kanchipuram ‚Ä¢ a digital shopping.
    </footer>
  </div>

  <script>
    let sarees = [];

    async function loadSareesFromCsv() {
      const response = await fetch("./assets/data/sarees.csv?v=" + Date.now());
      if (!response.ok) throw new Error("Failed to load sarees.csv");
      const text = await response.text();

      const lines = text.trim().split(/\r?\n/);
      if (lines.length <= 1) return [];

      const [headerLine, ...rows] = lines;
      const headers = headerLine.split(",").map(h => h.trim());

      return rows.filter(r => r.trim().length > 0).map((row, idx) => {
        const cols = row.split(",");
        const raw = {};
        headers.forEach((h,i) => { raw[h] = (cols[i]||"").trim(); });

        return {
          id: raw.id || idx + 1,
          title: raw.title || "",
          fabric: raw.fabric || "",
          condition: raw.condition || "",
          price: Number(raw.price || 0),
          city: raw.city || "Kanchipuram",
          blouse: raw.blouse || "",
          tagLine: raw.tagLine || "",
          whatsapp: raw.whatsapp || "919884191310",
          images: (raw.images || "").split("|") // support multiple images
        };
      });
    }

    const productsGrid = document.getElementById("productsGrid");
    const emptyState = document.getElementById("emptyState");

    const fabricFilter = document.getElementById("fabricFilter");
    const conditionFilter = document.getElementById("conditionFilter");
    const maxPriceFilter = document.getElementById("maxPriceFilter");
    const clearFiltersBtn = document.getElementById("clearFiltersBtn");

    function renderSarees(list) {
      productsGrid.innerHTML = "";
      if (!list.length) {
        emptyState.style.display = "block";
        return;
      }
      emptyState.style.display = "none";

      list.forEach(s => {
        const card = document.createElement("article");
        card.className = "card";

        // main image
        const mainImg = document.createElement("img");
        mainImg.src = s.images[0] ? `assets/images/${s.images[0]}` : "";
        mainImg.alt = s.title;
        mainImg.className = "card-main-img";

        // thumbnails
        const thumbs = document.createElement("div");
        thumbs.className = "card-thumbs";
        s.images.forEach(img => {
          if (!img) return;
          const t = document.createElement("img");
          t.src = `assets/images/${img}`;
          t.alt = s.title;
          t.className = "thumb-img";
          t.addEventListener("click", () => mainImg.src = t.src);
          thumbs.appendChild(t);
        });

        const cardBody = document.createElement("div");
        cardBody.className = "card-body";
        cardBody.innerHTML = `
          <div class="card-title">${s.title}</div>
          <div class="card-meta">
            <span>${s.fabric}</span>
            <span>Blouse: ${s.blouse}</span>
            <span>${s.city}</span>
          </div>
          <div class="card-tags">
            ${s.tagLine ? `<span class="card-tag">${s.tagLine}</span>` : ""}
          </div>
          <div class="card-price-row">
            <div class="price">‚Çπ${s.price.toLocaleString("en-IN")} <small>+ shipping</small></div>
            <button class="btn btn-outline btn-sm" data-id="${s.id}">WhatsApp</button>
          </div>
        `;

        card.appendChild(mainImg);
        if (s.images.length > 1) card.appendChild(thumbs);
        card.appendChild(cardBody);
        productsGrid.appendChild(card);
      });

      // WhatsApp button click
      document.querySelectorAll(".card button[data-id]").forEach(btn => {
        btn.addEventListener("click", () => {
          const id = btn.getAttribute("data-id");
          const saree = sarees.find(x => String(x.id) === String(id));
          if (!saree) return;

          const msg = `Hi PS Silks Kanchipuram, I'm interested in this saree:\n\n*${saree.title}*\nFabric: ${saree.fabric}\nCondition: ${saree.condition}\nPrice: ‚Çπ${saree.price.toLocaleString("en-IN")}\nCity: ${saree.city}\n\nIs it still available?`;
          const encoded = encodeURIComponent(msg);
          window.open(`https://wa.me/${saree.whatsapp}?text=${encoded}`, "_blank");
        });
      });
    }

    function applyFilters() {
      const f = fabricFilter.value;
      const c = conditionFilter.value;
      const p = maxPriceFilter.value ? Number(maxPriceFilter.value) : null;

      const filtered = sarees.filter(s => {
        if (f && s.fabric !== f) return false;
        if (c && s.condition !== c) return false;
        if (p !== null && s.price > p) return false;
        return true;
      });
      renderSarees(filtered);
    }

    fabricFilter.addEventListener("change", applyFilters);
    conditionFilter.addEventListener("change", applyFilters);
    maxPriceFilter.addEventListener("input", applyFilters);
    clearFiltersBtn.addEventListener("click", () => {
      fabricFilter.value = "";
      conditionFilter.value = "";
      maxPriceFilter.value = "";
      applyFilters();
    });

    document.getElementById("scrollToShopBtn").addEventListener("click", () => {
      document.getElementById("shop").scrollIntoView({ behavior: "smooth", block: "start" });
    });

    loadSareesFromCsv().then(list => {
      sarees = list;
      renderSarees(sarees);
    }).catch(err => {
      console.error(err);
      emptyState.textContent = "Could not load sarees list. Please try later.";
      emptyState.style.display = "block";
    });

    document.getElementById("yearSpan").textContent = new Date().getFullYear();
  </script>
</body>
</html>
